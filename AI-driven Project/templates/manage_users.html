<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manage Users | Admin Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    body { margin:0; font-family:"Segoe UI",sans-serif; background:#f4f6f8; }
    /* Header */
        header {
            background: #2c3e50;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 25px;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 100;
        }
        header h2 {
            margin: 0;
            font-size: 22px;
        }
        header .admin-info {
            font-size: 16px;
        }
        header .admin-info i {
            margin-right: 5px;
        }
        header .logout {
            color: #fff;
            text-decoration: none;
            margin-left: 8px;
            padding: 6px 10px;
            border-radius: 4px;
            background-color: #e74c3c;
            font-weight: 500;
        }
        header .logout:hover {
            background-color: #c0392b;
        }

        /* Sidebar */
        .container {
            display: flex;
            margin-top: 60px;
        }
        nav {
            width: 220px;
            background: #34495e;
            color: #fff;
            height: calc(100vh - 60px);
            padding-top: 20px;
            position: fixed;
            left: 0;
            top: 60px;
        }
        nav a {
            display: block;
            color: white;
            padding: 12px 20px;
            text-decoration: none;
            font-size: 15px;
        }
        nav a:hover,
        nav a.active {
            background: #16a085;
        }
        nav i {
            margin-right: 10px;
        }

    main { margin-left:240px; padding:20px; margin-top:70px; }
    table { width:100%; border-collapse:collapse; background:white; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    th,td { padding:10px; border:1px solid #ddd; text-align:center; }
    th { background:#2c3e50; color:white; }
    button { padding:5px 10px; border:none; border-radius:5px; cursor:pointer; }
    .btn-edit { background:#17a2b8; color:white; }
    .btn-delete { background:#e74c3c; color:white; }
    td[contenteditable="true"] { background:#fdfdfd; }
</style>
</head>
<body>

<nav>
    <a href="/admin_dashboard"><i class="fa fa-chart-line"></i> Dashboard</a>
    <a href="/manage_users" class="active"><i class="fa fa-users"></i> Manage Users</a>
    <a href="/system_reports"><i class="fa fa-file-alt"></i> Reports</a>
    <a href="/settings"><i class="fa fa-cogs"></i> Settings</a>
</nav>

 <header>
        <h2>Manage Users</h2>
    </header>


<main>
<h3>All Registered Users</h3>
<table id="usersTable">
    <tr>
        <th>ID</th><th>Name</th><th>Email</th><th>Role</th><th>Actions</th>
    </tr>

    {% for user in users %}
    <tr id="user-{{ user[0] }}" data-id="{{ user[0] }}" data-role="{{ user[3] }}">
    <td>{{ user[0] }}</td>
    <td contenteditable="true" data-field="name">{{ user[1] }}</td>
    <td contenteditable="true" data-field="email">{{ user[2] }}</td>
    <td>{{ user[3] }}</td>
    <td>
        <button class="btn-edit" onclick="updateUserFromRow(this)">Save</button>
        <button class="btn-delete" onclick="deleteUserFromRow(this)">Delete</button>
    </td>
</tr>

    {% else %}
    <tr><td colspan="5">No users found</td></tr>
    {% endfor %}
</table>
</main>

<script>
function updateUserFromRow(btn) {
    const row = btn.closest('tr');
    const id = row.dataset.id;
    const role = row.dataset.role;
    const name = row.querySelector('[data-field="name"]').innerText.trim();
    const email = row.querySelector('[data-field="email"]').innerText.trim();

    fetch(`/update_user/${role}/${id}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, email })
    })
    .then(res => res.json())
    .then(data => alert(data.message));
}

function deleteUserFromRow(btn) {
    const row = btn.closest('tr');
    const id = row.dataset.id;
    const role = row.dataset.role;

    if (!confirm("Are you sure you want to delete this user?")) return;

    fetch(`/delete_user/${role}/${id}`, { method: 'POST' })
        .then(res => res.json())
        .then(data => {
            alert(data.message);
            if (data.message.includes('success')) row.remove();
        });
}

</script>
</body>
</html>
